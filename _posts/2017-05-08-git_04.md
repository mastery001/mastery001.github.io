---
layout: post
title: Git系列之基础篇--commit
tags: git
categories: git
---

《Git系列》文章是博主阅读Git官方book提取整理出的内容，意在深入理解Git的工作机制、原理
<!--more-->

# 简介
前一节介绍了`add`命令--将当前工作目录的修改添加至暂存区，那么存储至暂存区后应当及时交由Git数据库进行版本管理，这时就是此篇文章需要介绍的`commit`命令大展身手的时候了！

# commit提交
>`commit`顾名思义为提交，其作用是将暂存区的内容提交至Git本地数据库，注意，每次提交都仅作用于当前[分支]()

1.语法

`git commit [options] ...`（更多参数详见：[git-commit](https://git-scm.com/docs/git-commit)）

2.提交内容

git进行提交操作时会保存一个提交对象，包含如下内容：

- 指向暂存内容快照的指针(暂存操作会为每一个文件使用SHA-1 哈希算法计算校验和，生成一个blob对象)
- 作者的姓名和邮箱
- 提交时输入的信息以及指向它的父对象的指针（首次提交产生的提交对象没有父对象，普通提交操作产生的提交对象有一个父对象，而由多个分支合并产生的提交对象有多个父对象）

## 初级使用
使用`add`命令我们已经将当前工作目录所有的修改都已经添加进暂存区了(可用`git status确认是否已经添加进暂存区`)，之后运行提交命令：

```
➜  test git:(master) ✗ git commit -m "first commit"
[master (root-commit) 6fffa3a] first commit
 1 file changed, 1 insertion(+)
 create mode 100644 test.txt
➜  test git:(master) git log
commit 6fffa3a925f1454195a297c7b5373c273eeaa5aa
Author: zouziwen <zouziwen@meituan.com>
Date:   Mon May 8 17:35:28 2017 +0800

    first commit
```

从commit执行后返回的信息可得出本次提交时在master分支，commit-id为6fffa3a，commit-message为first commit，一个文件被插入；并且如上例，可通过[git log](#git-log)来查询当前工作目录的提交历史

## 高级使用
与`add`命令相同，Git也提供了一组高级命令来完成完成`commit`操作，在前一节`add`高级命令的基础上向下执行

```
➜  test git:(master) git write-tree		// 在当前目录生成树
9d223a574a4b40a55bbf02a047c042c6c0b889a9
➜  test git:(master) echo "first commit" | git commit-tree 9d223a574a4b40a55bbf02a047c042c6c0b889a9   // 提交tree
85f186d00fe88ab272053dfe0d80b1f26dec6464
➜  test git:(master) git update-ref refs/heads/master 85f186d00fe88ab272053dfe0d80b1f26dec6464  //更新当前分支的commit
➜  test git:(master) git log 
commit 85f186d00fe88ab272053dfe0d80b1f26dec6464
Author: zouziwen <zouziwen@meituan.com>
Date:   Mon May 8 18:33:45 2017 +0800

    first commit
```

### Git对象

```
➜  test git:(master) git cat-file -t cb19826acbc17d65e6b492abf2b5b10930c184f3
blob
➜  test git:(master) git cat-file -t 9d223a574a4b40a55bbf02a047c042c6c0b889a9
tree
➜  test git:(master) git cat-file -t 85f186d00fe88ab272053dfe0d80b1f26dec6464
commit
```

如上命令分别得出Git对象存储的内容，如下图：

![Git对象](/images/git/commiter.png)

Git会为每个文件都生成一个数据对象(blob-object)，而为了解决文件名保存的问题，还提供了一个树对象(tree-object)。Git以一种类似于 UNIX 文件系统的方式存储内容，但作了些许简化。 所有内容均以树对象和数据对象的形式存储，其中树对象对应了 UNIX 中的目录项，数据对象则大致上对应了 inodes 或文件内容。 一个树对象包含了一条或多条树对象记录（tree entry），每条记录含有一个指向数据对象或者子树对象的 SHA-1 指针，以及相应的模式、类型、文件名信息。

Git会为每次commit生成一个commit对象，每个commit对象对应一个tree，而此tree对象相当于当前目录根目录；

![根目录的所有对象](/images/git/master_tree.png)

# git log
`git log`命令输出了当前工作分支的提交历史，默认不用任何参数的话，`git log`会按提交时间列出所有的更新，最近的更新排在最上面。这个命令会列出每个提交的 SHA-1 校验和、作者的名字和电子邮件地址、提交时间以及提交说明。

至于使用在官网文档中介绍的很清楚，这里就不多余举出。传送门：[git-log](https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2)

上一篇：[Git系列之基础篇--add](/2017-05-06/git_03)

下一篇：[Git系列之基础篇--push、pull、fetch](/2017-05-09/git_05)
